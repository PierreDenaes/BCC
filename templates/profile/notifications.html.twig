{% extends 'base.html.twig' %}

{% block title %}Mes Notifications
{% endblock %}

{% block stylesheets %}
	{{ parent() }}
	{{ encore_entry_link_tags('profile') }}
{% endblock %}

{% block javascripts %}
	{{ parent() }}
	{{ encore_entry_script_tags('profile') }}
{% endblock %}

{% block body %}
	<div class="container-fluid">
		<div class="wrapper d-flex align-items-stretch row gx-0 pe-4">

			{% include 'profile/_sidebar.html.twig' %}

			<div id="dynamicContent" class="p-4 p-md-5 mt-4 border col-9">
				<h2 class="mb-3">ðŸ“© Mes Notifications</h2>

				{% for notification in notifications %}
					<div class="alert {{ notification.isRead ? 'alert-secondary' : 'alert-info' }}">
						<strong>{{ notification.title }}</strong>
						<p>{{ notification.message }}</p>
						<small class="text-muted">ReÃ§u le
							{{ notification.createdAt|date('d/m/Y H:i') }}</small>
						{% if notification.pdfFilename %}
							<p>
								<strong>Document attachÃ© :</strong>
							</p>
							<p>
								ðŸ“„
								<a href="{{ asset('uploads/notifications/' ~ notification.pdfFilename) }}" target="_blank">
									TÃ©lÃ©charger le PDF
								</a>
							</p>

							<!-- Affichage du PDF en iframe si compatible -->
							<iframe src="{{ asset('uploads/notifications/' ~ notification.pdfFilename) }}" width="100%" height="600px" style="border: none;">
								Votre navigateur ne supporte pas l'affichage des PDF.
								<a href="{{ asset('uploads/notifications/' ~ notification.pdfFilename) }}">TÃ©lÃ©chargez-le ici</a>.
							</iframe>
						{% else %}
							<p>Aucun document joint.</p>
						{% endif %}
						{% if not notification.isRead %}
							<form method="post" class="mt-2">
								<input type="hidden" name="notification_id" value="{{ notification.id }}">
								<button type="submit" class="btn btn-sm btn-warning text-white">Marquer comme lu</button>
							</form>
						{% endif %}
						<form method="post" action="{{ path('profile_delete_notification', {id: notification.id}) }}" class="d-inline" onsubmit="return confirm('Es-tu sÃ»r de vouloir supprimer cette notification ?');">
							<button type="submit" class="btn btn-sm btn-danger">Supprimer</button>
						</form>
					</div>
				{% else %}
					<p>Aucune notification pour le moment.</p>
				{% endfor %}
			</div>
		</div>
	</div>
{% endblock %}
